<!DOCTYPE html>
<html lang="en" data-theme="light">
	<head>
		<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin></script>
		<script src="//cdn.jsdelivr.net/npm/eruda"></script>
		<script>eruda.init();</script>
		<!-- Primary Meta Tags -->
		<title>Fates List | Logging you in...</title>
		<meta name="title" content="Fates List | Discord Bot List">
		<meta name="description" content="Find, invite and discover the best Discord bots, now on Fates List.">
		<meta property="twitter:image" content="https://fateslist.xyz/static/assets/img/banner.webp">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Add Material font (Roboto) and Material icon as needed -->
		<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Lexend+Deca&display=swap" rel="stylesheet" media="none" onload="if(media!='all')media='all'">
		<link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" media="none" onload="if(media!='all')media='all'">
		<link rel="preconnect" href="https://cdn.jsdelivr.net/" crossorigin>
		<link rel="shortcut icon" href="/static/favicon.ico"/>
		<!-- Material CSS -->
		<link href="https://cdn.jsdelivr.net/gh/djibe/material@4.6.0-rc.2/css/material.min.css" rel="stylesheet" defer />
		<!-- Base Styles -->
		<link href="https://cdn.jsdelivr.net/gh/Fates-List/FatesList@main/static/assets/css/base.min.css" rel="stylesheet">
	</head>
	<body>
		<h3 class="text-center" id="msg">Logging you in...</h3>
	</body>
	<script>
		function loginUser() {
			searchParams = new URLSearchParams(window.location.search)
			code = searchParams.get("code")
			state = searchParams.get("state")
			$.ajax({
				url: "/api/users",
				method: "POST",
				contentType: "application/json",
				data: JSON.stringify({"code": code, "state": state}),
				statusCode: {
					206: function(data) {
						window.location.href = localStorage.getItem("login-redirect")
					},
					400: function(data) {
						$("#msg").html(data.responseJSON.reason)
					},
					422: function(data) {
						$("#msg").html("Invalid request")
					},
					500: function(data) {
						$("msg").html("Internal Server Error")
					}
				}
			})
		}
	$(document).ready(
		function() {
			setInterval(function() {loginUser()}, 3000)
		}
	)

	</script>
	<script src="/static/assets/prod/base.min.js?v=2"></script>
</html>
